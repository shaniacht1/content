category: Data Enrichment & Threat Intelligence
commonfields:
  id: ThreatConnect
  version: -1
configuration:
- defaultvalue: ""
  display: Access ID
  name: accessId
  required: true
  type: 0
- defaultvalue: ""
  display: Secret Key
  name: secretKey
  required: true
  type: 4
- defaultvalue: https://api.threatconnect.com
  display: baseUrl
  name: baseUrl
  required: true
  type: 0
- defaultvalue: ""
  display: Default Organization
  name: defaultOrg
  required: false
  type: 0
- defaultvalue: ""
  display: ProxyIP  (or http://${ip} )
  name: proxyIp
  required: false
  type: 0
- defaultvalue: ""
  display: ProxyPort
  name: proxyPort
  required: false
  type: 0
- defaultvalue: "3"
  display: Rating threshold for Malicious Indicators
  name: rating
  required: false
  type: 0
- defaultvalue: "50"
  display: Confidence threshold for Malicious Indicators
  name: confidence
  required: false
  type: 0
- defaultvalue: "7"
  display: Indicator Reputation Freshness (in days)
  name: freshness
  required: false
  type: 0
description: Threat Intelligence platform
display: ThreatConnect
image: data:image/png;base64,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
name: ThreatConnect
script:
  commands:
  - arguments:
    - default: true
      description: IPv4 or IPv6 address.
      name: ip
      required: true
    - description: 'A CSV list of client organizations, or any sources or communities
        to which a clientâ€™s API user has been granted permission. For example: owner1,owner2,owner3.'
      name: owners
    - description: Filter results by indicators whose rating is greater than the specified
        value (0-5).
      name: ratingThreshold
    - description: Filter results by indicators whose confidence is greater than the
        specified value (0-100).
      name: confidenceThreshold
    description: Searches for an IP address indicator.
    name: ip
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Actual score of the indicator.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IP addresses, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IP addresses, the full Description.
      type: string
  - arguments:
    - default: true
      description: A URL for which to search, for example, "www.demisto.com".
      name: url
      required: true
    - description: 'A CSV list of client organizations, or any sources or communities
        to which a clientâ€™s API user has been granted permission. For example: owner1,owner2,owner3.'
      name: owners
    - description: Filter results by indicators whose rating is greater than the specified
        value (0-5).
      name: ratingThreshold
    - description: Filter results by indicators whose confidence is greater than the
        specified value (0-100).
      name: confidenceThreshold
    description: Searches for a URL indicator.
    name: url
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Actual score of the indicator.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
  - arguments:
    - default: true
      description: Hash of the file. Can be "MD5", "SHA-1", or "SHA-256".
      name: file
      required: true
    - description: 'A CSV list of client organizations, or any sources or communities
        to which a clientâ€™s API user has been granted permission. For example: owner1,owner2,owner3.'
      name: owners
    - description: Filter results by indicators whose rating is greater than the specified
        value (0-5).
      name: ratingThreshold
    - description: Filter results by indicators whose confidence is greater than the
        specified value (0-100).
      name: confidenceThreshold
    description: Searches for a file indicator.
    name: file
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Actual score of the indicator.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments: []
    description: Retrieves all owners for the current account.
    name: tc-owners
    outputs:
    - contextPath: TC.Owner.Name
      description: Owner name.
      type: string
    - contextPath: TC.Owner.ID
      description: Owner ID.
      type: string
    - contextPath: TC.Owner.Type
      description: Owner type.
      type: string
  - arguments:
    - description: Filter results by the owner of the indicator.
      name: owner
    - description: Maximum number of results to return. Default is "500".
      name: limit
    description: Retrieves a list of all indicators.
    name: tc-indicators
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Actual score of the indicator.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IPs, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IP addresses, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments: []
    description: Returns a list of all ThreatConnect tags.
    name: tc-get-tags
    outputs:
    - contextPath: TC.Tags
      description: A list of tag names
      type: Unknown
  - arguments:
    - description: Tag value
      name: tag
      required: true
    - description: Indicator to tag, for example "ip", "file", "hash", or "url".
      name: indicator
      required: true
    - description: Filter by owner.
      name: owner
    description: Adds a tag to an exiting indicator.
    name: tc-tag-indicator
  - arguments:
    - default: true
      description: Indicator value by which to search. Can be an IP address, URL,
        or file hash. The command retrieves from all owners.
      name: indicator
      required: true
    - description: Filter results by indicators whose rating is greater than the specified
        value (0-5).
      name: ratingThreshold
    - description: Filter results by indicators whose confidence is greater than the
        specified value (0-100).
      name: confidenceThreshold
    description: Retrieves information about a specific indicator.
    name: tc-get-indicator
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Actual score of the indicator.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IPs, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IPs, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments:
    - default: true
      description: Tag value by which to filter.
      name: tag
      required: true
    - description: Filter by owner.
      name: owner
    description: Fetches all indicators that have the specified tag.
    name: tc-get-indicators-by-tag
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Actual score of the indicator.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IPs, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IPs, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments:
    - description: The indicator to add to ThreatConnect, for example "hash", "ip",
        "domain", "url", "email address", and so on.
      name: indicator
      required: true
    - description: Indicator rating (0-5).
      name: rating
    - description: Confidence of the indicator (1-100).
      name: confidence
    - description: Owner of new indicator. Default will be the defaultOrg parameter.
      name: owner
    description: Adds a new indicator to ThreatConnect.
    name: tc-add-indicator
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: IP.Address
      description: IP indicator address.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IPs, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IP addresses, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain Indicator's name
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments:
    - description: Owner of the new incident. Default will be the defaultOrg parameter.
      name: owner
    - default: true
      description: Incident group name.
      name: incidentName
      required: true
    - description: 'Incident creation time, in the format: "2017-03-21T00:00:00Z".'
      name: eventDate
    - description: Tag to apply to the incident.
      name: tag
    - auto: PREDEFINED
      description: Security label to apply to the incident. Can be "TLP:RED", "TLP:GREEN",
        "TLP:AMBER", or "TLP:WHITE".
      name: securityLabel
      predefined:
      - TLP:RED
      - TLP:GREEN
      - TLP:AMBER
      - TLP:WHITE
    - description: A description of the incident.
      name: description
    description: Creates a new incident group.
    name: tc-create-incident
    outputs:
    - contextPath: TC.Incident.Name
      description: Incident group name.
      type: string
    - contextPath: TC.Incident.Owner
      description: Incident owner.
      type: string
    - contextPath: TC.Incident.EventDate
      description: Event date.
      type: date
    - contextPath: TC.Incident.Tag
      description: Tag name.
      type: string
    - contextPath: TC.Incident.SecurityLabel
      description: Incident security label.
      type: string
    - contextPath: TC.Incident.ID
      description: Incident ID.
      type: Unknown
  - arguments:
    - default: true
      description: Filter by incident ID.
      name: incidentId
    - description: Filter by owner.
      name: owner
    - description: Filter by incident name.
      name: incidentName
    description: Fetches incidents from ThreatConnect.
    name: tc-fetch-incidents
    outputs:
    - contextPath: TC.Incident
      description: Incident group name.
      type: string
    - contextPath: TC.Incident.ID
      description: Incident ID.
      type: string
    - contextPath: TC.Incident.Owner
      description: Incident owner.
      type: string
  - arguments:
    - auto: PREDEFINED
      description: Indicator type. Can be "ADDRESSES", "EMAIL_ADDRESSES", "URLS",
        "HOSTS", "FILES", or "CUSTOM_INDICATORS".
      name: indicatorType
      predefined:
      - ADDRESSES
      - EMAIL_ADDRESSES
      - URLS
      - HOSTS
      - FILES
      - CUSTOM_INDICATORS
      required: true
    - description: Incident ID to which to associate the indicator.
      name: incidentId
      required: true
    - default: true
      description: 'Indicator value, for example: "hash", "ip", "url", and so on.'
      name: indicator
      required: true
    - description: Filter by owner.
      name: owner
    description: Associates an indicator to an existing incident. The indicator must
      exist before running this command. To add an indicator, run the tc-add-indicator
      command.
    name: tc-incident-associate-indicator
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 of the file indicator.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IP addresses, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IPs, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments:
    - description: Domain name.
      name: domain
      required: true
    - description: 'A CSV list of client organizations, or any sources or communities
        to which a clientâ€™s API user has been granted permission. For example: owner1,owner2,owner3.'
      name: owners
    - description: Filter results by indicators whose rating is greater than the specified
        value (0-5).
      name: ratingThreshold
    - description: Filter results by indicators whose confidence is greater than the
        specified value (0-100).
      name: confidenceThreshold
    description: Searches for a domain indicator.
    name: domain
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Actual score of the indicator.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
  - arguments:
    - default: true
      description: Incident ID.
      name: incidentId
      required: true
    - description: Filter indicators by owner.
      name: owner
    description: Returns indicators that are related to a specific incident.
    name: tc-get-incident-associate-indicators
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: DBotScore.Indicator
      description: Indicator value.
      type: string
    - contextPath: DBotScore.Type
      description: Indicator type.
      type: string
    - contextPath: DBotScore.Score
      description: Indicator actual score.
      type: number
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IP adddresses, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IP addresses, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments:
    - description: Indicator name.
      name: indicator
      required: true
    - description: Indicator rating.
      name: rating
    - description: Indicator confidence.
      name: confidence
    - description: Indicator size (only for files).
      name: size
    - description: Indicator dnsActive (only for hosts).
      name: dnsActive
    - description: Indicator whoisActive (only for hosts).
      name: whoisActive
    - description: 'A CSV list of field:value pairs to update. For example: "rating=3,confidence=42,description=helloWorld"'
      name: updatedValues
    - auto: PREDEFINED
      description: mark indicator as false positive
      name: falsePositive
      predefined:
      - "True"
      - "False"
    - description: Number observations on this indicator.
      name: observations
    - auto: PREDEFINED
      description: Security label to apply to the incident. Can be "TLP:RED", "TLP:GREEN",
        "TLP:AMBER", or "TLP:WHITE".
      name: securityLabel
      predefined:
      - TLP:RED
      - TLP:GREEN
      - TLP:AMBER
      - TLP:WHITE
    - description: Assess confidence.
      name: threatAssessConfidence
    - description: Assess rating.
      name: threatAssessRating
    description: Updates a ThreatConnect indicator.
    name: tc-update-indicator
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified date.
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 of the file indicator.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IP addresses, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IP addresses, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments:
    - description: Name of the indicator from which to remove a tag.
      name: indicator
      required: true
    - description: Name of the tag to remove from the indicator.
      name: tag
      required: true
    description: Removes a tag from a specified indicator.
    name: tc-delete-indicator-tag
    outputs:
    - contextPath: TC.Indicator.Name
      description: Indicator name.
      type: string
    - contextPath: TC.Indicator.Type
      description: Indicator type.
      type: string
    - contextPath: TC.Indicator.ID
      description: Indicator ID.
      type: string
    - contextPath: TC.Indicator.Description
      description: Indicator description.
      type: string
    - contextPath: TC.Indicator.Owner
      description: Indicator owner.
      type: string
    - contextPath: TC.Indicator.CreateDate
      description: Indicator creation time.
      type: date
    - contextPath: TC.Indicator.LastModified
      description: Indicator last modified. date
      type: date
    - contextPath: TC.Indicator.Rating
      description: Indicator rating.
      type: number
    - contextPath: TC.Indicator.Confidence
      description: Indicator confidence.
      type: number
    - contextPath: TC.Indicator.WhoisActive
      description: Indicator Whois active (for domains only).
      type: string
    - contextPath: TC.Indicator.File.MD5
      description: MD5 hash for the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: TC.Indicator.File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: IP.Address
      description: IP address of the indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: For malicious IP addresses, the vendor that made the decision.
      type: string
    - contextPath: IP.Malicious.Description
      description: For malicious IP addresses, the full description.
      type: string
    - contextPath: URL.Data
      description: URL indicator data.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the full description.
      type: string
    - contextPath: Domain.Name
      description: Domain indicator name.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
      type: string
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the full description.
      type: string
    - contextPath: File.MD5
      description: MD5 hash of the file indicator.
      type: string
    - contextPath: File.SHA1
      description: SHA1 hash of the file indicator.
      type: string
    - contextPath: File.SHA256
      description: SHA256 hash of the file indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the full description.
      type: string
  - arguments:
    - description: Name of the indicator to delete.
      name: indicator
      required: true
    description: Deletes an indicator from ThreatConnect.
    name: tc-delete-indicator
  - arguments:
    - description: Name for the new campaign.
      name: name
      required: true
    - description: First seen date of the campaign.
      name: firstSeen
    - description: Owner of new incident. default will be the defaultOrg parameter.
      name: owner
    - description: A description for the campaign.
      name: description
    - description: A tag to apply to the campaign.
      name: tag
    - description: Security label for the campaign, for example, "TLP Green".
      name: securityLabel
    description: Creates a ThreatConnect group from type Campaign.
    name: tc-create-campaign
    outputs:
    - contextPath: TC.Campaign.Name
      description: Campaign name.
      type: string
    - contextPath: TC.Campaign.Owner
      description: Campaign owner.
      type: string
    - contextPath: TC.Campaign.FirstSeen
      description: First seen date of the campaign.
      type: date
    - contextPath: TC.Campaign.Tag
      description: Campaign tag.
      type: string
    - contextPath: TC.Campaign.SecurityLevel
      description: Campaign security label.
      type: string
    - contextPath: TC.Campaign.ID
      description: Campaign ID.
      type: string
  - arguments:
    - description: event Name
      name: name
      required: true
    - description: Event Date. if not specified, will use current date
      name: eventDate
    - auto: PREDEFINED
      description: Event's status
      name: status
      predefined:
      - Needs Review
      - False Positive
      - No Further Action
      - Escalated
    - description: Event's owner
      name: owner
    - description: Event description
      name: description
    - description: Tag the event
      name: tag
    description: Creates a ThreatConnect group from type Event.
    name: tc-create-event
    outputs:
    - contextPath: TC.Event.Name
      description: Event name.
      type: string
    - contextPath: TC.Event.Date
      description: Event date.
      type: date
    - contextPath: TC.Event.Status
      description: Event status.
      type: string
    - contextPath: TC.Event.Owner
      description: Event owner.
      type: string
    - contextPath: TC.Event.Tag
      description: Event tag.
      type: string
    - contextPath: TC.Event.ID
      description: Event ID.
      type: string
  - arguments:
    - description: Threat group name.
      name: name
      required: true
    description: Creates a ThreatConnect group from type Threats
    name: tc-create-threat
    outputs:
    - contextPath: TC.Threat.Name
      description: Threat name.
      type: string
    - contextPath: TC.Threat.ID
      description: Threat ID.
      type: string
  - arguments:
    - description: Group ID.
      name: groupID
      required: true
    - auto: PREDEFINED
      description: Group type to delete. Can be "Incidents", "Events", "Campaigns",
        or "Threats".
      name: type
      predefined:
      - Incidents
      - Events
      - Campaigns
      - Threats
      required: true
    description: Deletes a group from ThreatConnect.
    name: tc-delete-group
  - arguments:
    - description: The ID of the group to which to add attributes. To get the ID,
        run the tc-get-groups command.
      name: group_id
      required: true
    - description: The attribute type to add to the group. Can be found in the UI
        within a specific group or under organization settings.
      name: attribute_type
      required: true
    - description: The attribute value.
      name: attribute_value
      required: true
    - auto: PREDEFINED
      description: The group type. Can be "adversaries", "campaigns", "documents",
        "emails", "events", "incidents", "intrusionSets", "reports", "signatures",
        or "threats".
      name: group_type
      predefined:
      - adversaries
      - campaigns
      - documents
      - emails
      - events
      - incidents
      - intrusionSets
      - reports
      - signatures
      - threats
      required: true
    description: Adds an attribute to a specific event.
    name: tc-add-group-attribute
    outputs:
    - contextPath: TC.Group.DateAdded
      description: The date that the attribute was added.
      type: Date
    - contextPath: TC.Group.ID
      description: Group ID to which the attribute was added.
      type: Number
    - contextPath: TC.Group.LastModified
      description: The date that the attribute was last modified.
      type: Date
    - contextPath: TC.Group.Type
      description: The group type.
      type: String
    - contextPath: TC.Group.Value
      description: The attribute value.
      type: String
  - arguments: []
    description: Returns a list of events.
    name: tc-get-events
    outputs:
    - contextPath: TC.Event.DateAdded
      description: The date that the event was added.
      type: Date
    - contextPath: TC.Event.EventDate
      description: Event date.
      type: Date
    - contextPath: TC.Event.ID
      description: Event ID.
      type: Number
    - contextPath: TC.Event.OwnerName
      description: Owner name.
      type: String
    - contextPath: TC.Event.Status
      description: Event status.
      type: String
  - arguments:
    - auto: PREDEFINED
      description: The group type to return. Can be "adversaries", "campaigns", "documents",
        "emails", "events", "incidents", "intrusionSets", "reports", "signatures",
        or "threats".
      name: group_type
      predefined:
      - adversaries
      - campaigns
      - documents
      - emails
      - events
      - incidents
      - intrusionSets
      - reports
      - signatures
      - threats
      required: true
    description: Returns all groups by group type.
    name: tc-get-groups
    outputs:
    - contextPath: TC.Group.DateAdded
      description: The date that the group was added.
      type: Date
    - contextPath: TC.Group.EventDate
      description: Event date.
      type: Date
    - contextPath: TC.Group.ID
      description: Group ID.
      type: Number
    - contextPath: TC.Group.Name
      description: Group name.
      type: String
    - contextPath: TC.Group.OwnerName
      description: Group owner name.
      type: String
    - contextPath: TC.Group.Status
      description: Group status.
      type: String
  - arguments:
    - description: The group ID. To get the ID, run the tc-get-groups command.
      name: group_id
      required: true
    - auto: PREDEFINED
      description: The group type. Can be "adversaries", "campaigns", "documents",
        "emails", "events", "incidents", "intrusionSets", "reports", "signatures",
        or "threats".
      name: group_type
      predefined:
      - adversaries
      - campaigns
      - documents
      - emails
      - events
      - incidents
      - intrusionSets
      - reports
      - signatures
      - threats
      required: true
    - description: The name of the security label to add to the group, for example,
        "TLP:GREEN".
      name: security_label_name
      required: true
    description: Adds a security label to a specific group.
    name: tc-add-group-security-label
  - arguments:
    - description: The group ID. To get the ID, run the tc-get-groups command.
      name: group_id
      required: true
    - auto: PREDEFINED
      description: The group type. Can be "adversaries", "campaigns", "documents",
        "emails", "events", "incidents", "intrusionSets", "reports", "signatures",
        or "threats".
      name: group_type
      predefined:
      - adversaries
      - campaigns
      - documents
      - emails
      - events
      - incidents
      - intrusionSets
      - reports
      - signatures
      - threats
      required: true
    - description: Name of the tag to add to the group.
      name: tag_name
      required: true
    description: Adds tags to a specific group.
    name: tc-add-group-tag
  - arguments: []
    description: Returns all indicator types available on your instance of ThreatConnect.
    name: tc-get-indicator-types
    outputs:
    - contextPath: TC.IndicatorType.ApiBranch
      description: API branch.
      type: String
    - contextPath: TC.IndicatorType.ApiEntity
      description: API entity.
      type: String
    - contextPath: TC.IndicatorType.CasePreference
      description: Indicator case preference.
      type: String
    - contextPath: TC.IndicatorType.Custom
      description: Custom indicator.
      type: Boolean
    - contextPath: TC.IndicatorType.Parsable
      description: Whether the indicator is parsable.
      type: Boolean
    - contextPath: TC.IndicatorType.Value1Type
      description: Indicator value.
      type: String
    - contextPath: TC.IndicatorType.Value1Label
      description: Indicator value label.
      type: String
  - arguments:
    - description: The indicator type. To get the available types, run the tc-get-indicator-types
        command (API branch column).
      name: indicator_type
      required: true
    - description: 'The indicator to associate to the group, for example: "indicator_type=emailAddresses".
        indicator=a@a.co.il)'
      name: indicator
      required: true
    - auto: PREDEFINED
      description: The group type. Can be "adversaries", "campaigns", "documents",
        "emails", "events", "incidents", "intrusionSets", "reports", "signatures",
        or "threats".
      name: group_type
      predefined:
      - adversaries
      - campaigns
      - documents
      - emails
      - events
      - incidents
      - intrusionSets
      - reports
      - signatures
      - threats
      required: true
    - description: Group ID. To get the group ID, run the tc-get-groups command.
      name: group_id
      required: true
    description: Associates an indicator to a group.
    name: tc-group-associate-indicator
    outputs:
    - contextPath: TC.Group.GroupID
      description: The group ID.
      type: Number
    - contextPath: TC.Group.GroupType
      description: Group type.
      type: String
    - contextPath: TC.Group.Indicator
      description: Indicator value.
      type: String
    - contextPath: TC.Group.IndicatorType
      description: Indicator type.
      type: String
  - arguments:
    - description: The name of the file to display in the UI.
      name: file_name
      required: true
    - description: File name.
      name: name
      required: true
    - auto: PREDEFINED
      description: Whether the file is malware. If "true", creates a password-protected
        ZIP file on your local machine that contains the sample, and then uploads
        the ZIP file.
      name: malware
      predefined:
      - "true"
      - "false"
    - description: The password for the malware ZIP file.
      name: password
    - description: Security label for the group.
      name: security_label
    - description: Group description.
      name: description
    - description: Entry ID of the file, as displayed in the War Room.
      name: entry_id
      required: true
    description: Creates a document group.
    name: tc-create-document-group
    outputs:
    - contextPath: TC.Group.ID
      description: Group ID.
      type: Number
    - contextPath: TC.Group.Name
      description: Group name.
      type: String
    - contextPath: TC.Group.Owner
      description: Group owner.
      type: String
    - contextPath: TC.Group.EventDate
      description: Event date.
      type: Date
    - contextPath: TC.Group.Description
      description: Group description.
      type: String
    - contextPath: TC.Group.SecurityLabel
      description: Group security label.
      type: String
  dockerimage: demisto/threatconnect-sdk
  runonce: false
  script: |2-




    ''' IMPORTS '''
    from urlparse import urlparse
    from datetime import timedelta
    from distutils.util import strtobool
    from threatconnect import ThreatConnect
    from threatconnect.RequestObject import RequestObject
    from threatconnect.Config.ResourceType import ResourceType
    from threatconnect.Config.FilterOperator import FilterOperator

    '''GLOBAL VARS'''
    FRESHNESS = int(demisto.params()['freshness'])
    MAX_CONTEXT = 100

    ''' HELPER FUNCTIONS '''


    def get_client():
        params = demisto.params()
        access = params['accessId']
        secret = params['secretKey']
        default_org = params.get('defaultOrg')
        url = params['baseUrl']
        proxy_ip = params['proxyIp']
        proxy_port = params['proxyPort']

        tc = ThreatConnect(access, secret, default_org, url)
        if proxy_ip and proxy_port and len(proxy_ip) > 0 and len(proxy_port) > 0:
            tc.set_proxies(proxy_ip, int(proxy_port))

        return tc


    def calculate_freshness_time(freshness):
        t = datetime.now() - timedelta(days=freshness)
        return t.strftime('%Y-%m-%dT00:00:00Z')


    def create_context(indicators, include_dbot_score=False):
        context = {
            'DBotScore': [],
            outputPaths['ip']: [],
            outputPaths['url']: [],
            outputPaths['domain']: [],
            outputPaths['file']: [],
            'TC.Indicator(val.ID && val.ID === obj.ID)': [],
        }  # type: dict
        tc_type_to_demisto_type = {
            'Address': 'ip',
            'URL': 'url',
            'Host': 'domain',
            'File': 'file'
        }
        type_to_value_field = {
            'Address': 'ip',
            'URL': 'text',
            'Host': 'hostName',
            'File': 'md5'
        }

        for ind in indicators:
            indicator_type = tc_type_to_demisto_type.get(ind['type'], ind['type'])
            value_field = type_to_value_field.get(ind['type'], 'summary')
            value = ind.get(value_field, ind.get('summary', ''))

            if ind.get('confidence') is not None:  # returned in specific indicator request - SDK
                confidence = int(ind['confidence'])
            else:
                # returned in general indicator request - REST API
                confidence = int(ind.get('threatAssessConfidence', 0))

            if ind.get('rating') is not None:  # returned in specific indicator request - SDK
                rating = int(ind['rating'])
            else:
                # returned in general indicator request - REST API
                rating = int(ind.get('threatAssessRating', 0))

            if confidence >= demisto.params()['rating'] and rating >= demisto.params()['confidence']:
                dbot_score = 3
                desc = ''
                if hasattr(ind, 'description'):
                    desc = ind.description
                mal = {
                    'Malicious': {
                        'Vendor': 'ThreatConnect',
                        'Description': desc,
                    }
                }
                if indicator_type == 'ip':
                    mal['Address'] = value

                elif indicator_type == 'file':
                    mal['MD5'] = value
                    mal['SHA1'] = ind.get('sha1')
                    mal['SHA256'] = ind.get('sha256')

                elif indicator_type == 'url':
                    mal['Data'] = value

                elif indicator_type == 'domain':
                    mal['Name'] = value

                context_path = outputPaths.get(indicator_type)
                if context_path is not None:
                    context[context_path].append(mal)

            elif rating >= 1:
                dbot_score = 2
            else:
                dbot_score = 1

            if include_dbot_score:
                context['DBotScore'].append({
                    'Indicator': value,
                    'Score': dbot_score,
                    'Type': indicator_type,
                    'Vendor': 'ThreatConnect'
                })

            context['TC.Indicator(val.ID && val.ID === obj.ID)'].append({
                'ID': ind['id'],
                'Name': value,
                'Type': ind['type'],
                'Owner': ind['ownerName'],
                'Description': ind.get('description'),
                'CreateDate': ind['dateAdded'],
                'LastModified': ind['lastModified'],
                'Rating': rating,
                'Confidence': confidence,

                # relevant for domain
                'Active': ind.get('whoisActive'),

                # relevant for file
                'File.MD5': ind.get('md5'),
                'File.SHA1': ind.get('sha1'),
                'File.SHA256': ind.get('sha256'),
            })

        context = {k: createContext(v, removeNull=True)[:MAX_CONTEXT] for k, v in context.items() if len(v) > 0}
        return context, context.get('TC.Indicator(val.ID && val.ID === obj.ID)', [])


    # pylint: disable=E1101
    def get_indicators(indicator_value=None, indicator_type=None, owners=None, rating_threshold=-1, confidence_threshold=-1,
                       freshness=None):
        tc = get_client()
        indicators_obj = tc.indicators()
        _filter = indicators_obj.add_filter()

        if indicator_value is not None:
            _filter.add_indicator(indicator_value)
        if indicator_type is not None:
            _filter.add_pf_type(indicator_type, FilterOperator.EQ)

        if owners is not None:
            owners = owners.split(",")
            _filter.add_owner(owners)

        if rating_threshold != -1:
            _filter.add_pf_rating(rating_threshold, FilterOperator.GE)
        if confidence_threshold != -1:
            _filter.add_pf_confidence(confidence_threshold, FilterOperator.GE)
        if freshness is not None:
            _filter.add_pf_last_modified(calculate_freshness_time(freshness), FilterOperator.GE)

        raw_indicators = indicators_obj.retrieve()

        indicators = [json.loads(indicator.json) for indicator in raw_indicators]

        return indicators


    ''' FUNCTIONS '''


    def ip_command():
        args = demisto.args()
        owners = args.get('owners', demisto.params().get('defaultOrg'))
        if not owners:
            return_error('You must specify an owner in the command, or by using the Organization parameter.')
        rating_threshold = int(args.get('ratingThreshold', -1))
        confidence_threshold = int(args.get('confidenceThreshold', -1))
        ip_addr = args['ip']

        ec, indicators = ip(ip_addr, owners, rating_threshold, confidence_threshold)

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect IP Reputation for: {}'.format(ip_addr), indicators,
                                             headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def ip(ip_addr, owners, rating_threshold, confidence_threshold):
        indicators = get_indicators(ip_addr, 'Address', owners, rating_threshold, confidence_threshold)

        if not indicators:
            demisto.results('Make sure that the indicator exists in your ThreatConnect environment')
        ec, indicators = create_context(indicators, include_dbot_score=True)

        return ec, indicators


    def url_command():
        args = demisto.args()
        owners = args.get('owners', demisto.params().get('defaultOrg'))
        if not owners:
            return_error('You must specify an owner in the command, or by using the Organization parameter.')
        url_addr = args['url']
        parsed_url = urlparse(url_addr)
        if not parsed_url.scheme:
            return_error('Please provide a valid URL including a protocol (http/https)')
        rating_threshold = int(args.get('ratingThreshold', -1))
        confidence_threshold = int(args.get('confidenceThreshold', -1))

        ec, indicators = url(url_addr, owners, rating_threshold, confidence_threshold)
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect URL Reputation for: {}'.format(url_addr), indicators,
                                             headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def url(url_addr, owners, rating_threshold, confidence_threshold):
        indicators = get_indicators(url_addr, 'URL', owners, rating_threshold, confidence_threshold)
        if not indicators:
            demisto.results('Make sure that the indicator exists in your ThreatConnect environment')
        ec, indicators = create_context(indicators, include_dbot_score=True)

        return ec, indicators


    def file_command():
        args = demisto.args()
        owners = args.get('owners', demisto.params().get('defaultOrg'))
        if not owners:
            return_error('You must specify an owner in the command, or by using the Organization parameter.')
        file_name = args['file']
        rating_threshold = int(args.get('ratingThreshold', -1))
        confidence_threshold = int(args.get('confidenceThreshold', -1))

        ec, indicators = _file(file_name, owners, rating_threshold, confidence_threshold)
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect File Report for: {}'.format(file_name), indicators,
                                             headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def _file(url_addr, owners, rating_threshold, confidence_threshold):
        indicators = get_indicators(url_addr, 'File', owners, rating_threshold, confidence_threshold)
        if not indicators:
            demisto.results('Make sure that the indicator exists in your ThreatConnect environment')
        ec, indicators = create_context(indicators, include_dbot_score=True)

        return ec, indicators


    def domain_command():
        args = demisto.args()
        owners = args.get('owners', demisto.params().get('defaultOrg'))
        if not owners:
            return_error('You must specify an owner in the command, or by using the Organization parameter.')
        rating_threshold = int(args.get('ratingThreshold', -1))
        confidence_threshold = int(args.get('confidenceThreshold', -1))
        domain_addr = args['domain']

        ec, indicators = domain(domain_addr, owners, rating_threshold, confidence_threshold)
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect Domain Reputation for: {}'.format(domain_addr), indicators,
                                             headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def domain(domain_addr, owners, rating_threshold, confidence_threshold):
        indicators = get_indicators(domain_addr, 'Host', owners, rating_threshold, confidence_threshold)
        ec, indicators = create_context(indicators, include_dbot_score=True)

        return ec, indicators


    def tc_owners_command():
        raw_owners = tc_owners()
        owners = []
        for owner in raw_owners['data']['owner']:
            owners.append({
                'ID': owner['id'],
                'Type': owner['type'],
                'Name': owner['name']
            })

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_owners,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect Owners:', owners),
            'EntryContext': {'TC.Owner(val.ID && val.ID === obj.ID)': owners}
        })


    @logger
    def tc_owners():
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('GET')
        ro.set_request_uri('/v2/owners')
        results = tc.api_request(ro)

        return results.json()


    def tc_indicators_command():
        args = demisto.args()
        limit = int(args.get('limit', 500))
        owners = args.get('owners')
        ec, indicators, raw_response = tc_indicators(owners, limit)

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_response,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect Indicators:', indicators, headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def tc_indicators(owners, limit):
        tc = get_client()
        tc.set_api_result_limit(limit)
        ro = RequestObject()
        ro.set_http_method('GET')
        ro.set_request_uri('/v2/indicators?resultLimit={}'.format(limit))

        if owners is not None:
            ro.set_owner(owners)
            ro.set_owner_allowed(True)

        response = tc.api_request(ro).json()
        indicators = response['data']['indicator']
        ec, indicators = create_context(indicators, include_dbot_score=True)

        return ec, indicators, response


    def tc_get_tags_command():
        raw_response = tc_get_tags()
        tags = [t['name'] for t in raw_response['data']['tag']]

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_response,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect Tags:', tags, headers='Name'),
            'EntryContext': {'TC.Tags': tags}
        })


    @logger
    def tc_get_tags():
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('GET')
        ro.set_request_uri('/v2/tags')

        return tc.api_request(ro).json()


    def tc_tag_indicator_command():
        args = demisto.args()
        indicator = args['indicator']
        tag = args['tag']
        owners = args.get('owner')
        indicators = tc_tag_indicator(indicator, tag, owners)

        md = []
        for ind in indicators:
            md.append('Indicator {} with ID {}, was tagged with: {}'.format(indicator, ind.id, tag))

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['text'],
            'Contents': '\n'.join(md)
        })


    def tc_tag_indicator(indicator, tag, owners=None):
        tc = get_client()
        indicators = tc.indicators()
        filter1 = indicators.add_filter()
        filter1.add_indicator(indicator)

        if owners is not None:
            owners = owners.split(",")
            filter1.add_owner(owners)

        indicators = indicators.retrieve()
        for indicator in indicators:
            indicator.add_tag(tag)
            indicator.commit()

        return indicators


    def tc_get_indicator_command():
        args = demisto.args()
        owners = args.get('owners')
        rating_threshold = int(args.get('ratingThreshold', -1))
        confidence_threshold = int(args.get('confidenceThreshold', -1))
        indicator = args['indicator']

        ec, indicators, raw_indicators = tc_get_indicator(indicator, owners, rating_threshold, confidence_threshold)

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect indicator for: {}'.format(indicator), indicators,
                                             headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def tc_get_indicator(indicator, owners, rating_threshold, confidence_threshold):
        raw_indicators = get_indicators(indicator, owners=owners, rating_threshold=rating_threshold,
                                        confidence_threshold=confidence_threshold)
        ec, indicators = create_context(raw_indicators, include_dbot_score=True)

        return ec, indicators, raw_indicators


    def tc_get_indicators_by_tag_command():
        args = demisto.args()
        tag = args['tag']
        owner = args.get('owner')
        response = tc_get_indicators_by_tag(tag, owner)
        raw_indicators = response['data']['indicator']
        ec, indicators = create_context(raw_indicators, include_dbot_score=True)

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': response,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('ThreatConnect Indicators with tag: {}'.format(tag), indicators,
                                             headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def tc_get_indicators_by_tag(tag, owner):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('GET')
        cmd = '/v2/tags/{}/indicators'.format(tag)
        if owner is not None:
            cmd += '?owner={}'.format(owner)

        ro.set_request_uri(cmd)

        return tc.api_request(ro).json()


    def tc_add_indicator_command():
        args = demisto.args()
        indicator = args['indicator']
        owner = args.get('owner', demisto.params().get('defaultOrg'))
        if not owner:
            return_error('You must specify an owner in the command, or by using the Organization parameter.')

        rating = int(args.get('rating', 0))
        confidence = int(args.get('confidence', 0))

        tc_add_indicator(indicator, owner, rating, confidence)
        # get the indicator for full object data
        raw_indicators = get_indicators(indicator)
        ec, indicators = create_context(raw_indicators)
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('Created new indicator successfully:', indicators,
                                             headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def tc_add_indicator(indicator, organization, rating=0, confidence=0):
        tc = get_client()
        indicators = tc.indicators()
        indicator = indicators.add(indicator, organization)
        indicator.set_rating(rating)
        indicator.set_confidence(confidence)

        return json.loads(indicator.commit().json)


    def tc_create_incident_command():
        args = demisto.args()
        incident_name = args['incidentName']
        owner = args.get('owner', demisto.params()['defaultOrg'])
        if not owner:
            return_error('You must specify an owner in the command, or by using the Organization parameter.')

        event_date = args.get('eventDate', datetime.utcnow().isoformat().split('.')[0] + 'Z')
        tag = args.get('tag')
        security_label = args.get('securityLabel')
        description = args.get('description')

        raw_incident = tc_create_incident(incident_name, owner, event_date, tag, security_label, description)
        ec = {
            'ID': raw_incident['id'],
            'Name': raw_incident['name'],
            'Owner': raw_incident['ownerName'],
            'EventDate': raw_incident['eventDate'],
            'Tag': tag,
            'SecurityLabel': security_label
        }

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_incident,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': 'Incident {} Created Successfully'.format(incident_name),
            'EntryContext': {
                'TC.Incident(val.ID && val.ID === obj.ID)': createContext([ec], removeNull=True)
            }
        })


    @logger
    def tc_create_incident(incident_name, owner, event_date, tag=None, security_label=None, description=None):
        tc = get_client()
        incidents = tc.incidents()
        incident = incidents.add(incident_name, owner)
        incident.set_event_date(event_date)
        if tag is not None:
            incident.add_tag(tag)
        if security_label is not None:
            incident.set_security_label(security_label)
        if description is not None:
            incident.add_attribute('Description', description)

        return json.loads(incident.commit().json)


    def tc_fetch_incidents_command():
        args = demisto.args()
        incident_id = args.get('incidentId')
        incident_name = args.get('incidentName')
        owner = args.get('owner')

        raw_incidents = tc_fetch_incidents(incident_id, incident_name, owner)
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_incidents,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('Incidents:', raw_incidents, headerTransform=pascalToSpace),
            'EntryContext': {
                'TC.Incident(val.ID && val.ID === obj.ID)': createContext(raw_incidents, removeNull=True),
                'ThreatConnect.incidents': raw_incidents  # backward compatible
            }
        })


    @logger
    def tc_fetch_incidents(incident_id, incident_name, owner):
        tc = get_client()
        incidents = tc.incidents()
        if any((incident_id, owner, incident_name)):
            filter1 = incidents.add_filter()
            if incident_id is not None:
                filter1.add_id(int(incident_id))
            if owner is not None:
                filter1.add_owner(owner)
            if incident_name is not None:
                filter1.add_pf_name(incident_name)

        incidents.retrieve()
        return [json.loads(incident.json) for incident in incidents]


    def tc_get_incident_associate_indicators_command():
        args = demisto.args()
        incident_id = int(args['incidentId'])
        owners = args.get('owner')
        if owners is not None:
            owners = owners.split(",")

        raw_indicators = tc_get_incident_associate_indicators(incident_id, owners)
        ec, indicators = create_context(raw_indicators, include_dbot_score=True)
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('Incident Associated Indicators:', indicators, headerTransform=pascalToSpace),
            'EntryContext': ec
        })


    @logger
    def tc_get_incident_associate_indicators(incident_id, owners):
        tc = get_client()
        incidents = tc.incidents()
        _filter = incidents.add_filter()
        _filter.add_id(incident_id)

        incidents = incidents.retrieve()
        indicators = []
        for incident in incidents:
            for ind in incident.indicator_associations:
                if ind.type == 'File':
                    indicators.append(ind.indicator['md5'])
                else:
                    indicators.append(ind.indicator)
        if len(indicators) == 0:
            return []

        indicators_obj = tc.indicators()
        _filter = indicators_obj.add_filter()
        if owners is not None:
            _filter.add_owner(owners)
        for ind in indicators:
            _filter.add_indicator(ind)

        raw_indicators = indicators_obj.retrieve()
        return [json.loads(indicator.json) for indicator in raw_indicators]


    def tc_incident_associate_indicator_command():
        args = demisto.args()
        incident_id = int(args['incidentId'])
        indicator = args['indicator']
        types = {
            'ADDRESSES': ResourceType.ADDRESSES,
            'EMAIL_ADDRESSES': ResourceType.EMAIL_ADDRESSES,
            'FILES': ResourceType.FILES,
            'HOSTS': ResourceType.HOSTS,
            'URLS': ResourceType.URLS,
        }
        indicator_type = types.get(args['indicatorType'], args['indicatorType'])
        owners = args.get('owner')
        if owners is not None:
            owners = owners.split(",")

        incidents = tc_incident_associate_indicator(incident_id, indicator_type, indicator, owners)
        md = []
        for inc in incidents:
            md.append('Incident {} with ID {}, was tagged with: {}'.format(inc['name'], inc['id'], indicator))

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['text'],
            'Contents': incidents,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join(md),
            'EntryContext': {'TC.Incident(val.ID && val.ID === obj.ID)': createContext(incidents, removeNull=True)}
        })


    @logger
    def tc_incident_associate_indicator(incident_id, indicator_type, indicator, owners):
        tc = get_client()
        incidents = tc.incidents()
        filter1 = incidents.add_filter()
        filter1.add_id(incident_id)
        if owners is not None:
            filter1.add_owner(owners)
        raw_incidents = incidents.retrieve()

        incidents = []
        for incident in raw_incidents:
            incident.associate_indicator(indicator_type, indicator)
            incidents.append(json.loads(incident.commit().json))

        return incidents


    def tc_update_indicator_command():
        args = demisto.args()
        indicator = args['indicator']
        rating = args.get('rating')
        confidence = args.get('confidence')
        size = args.get('size')
        dns_active = args.get('dnsActive')
        whois_active = args.get('whoisActive')
        false_positive = args.get('falsePositive', 'False') == 'True'
        observations = int(args.get('observations', 0))
        security_label = args.get('securityLabel')
        threat_assess_confidence = int(args.get('threatAssessConfidence', -1))
        threat_assess_rating = int(args.get('threatAssessRating', -1))

        raw_indicators = tc_update_indicator(indicator, rating=rating, confidence=confidence, size=size,
                                             dns_active=dns_active, whois_active=whois_active,
                                             false_positive=false_positive, observations=observations,
                                             security_label=security_label,
                                             threat_assess_confidence=threat_assess_confidence,
                                             threat_assess_rating=threat_assess_rating)
        ec, indicators = create_context(raw_indicators)

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join('Indicator {} Updated Successfully'.format(ind['ID']) for ind in indicators),
            'EntryContext': ec
        })


    @logger
    def tc_update_indicator(indicator, rating=None, confidence=None, size=None, dns_active=None, whois_active=None,
                            false_positive=False, observations=0, security_label=None, threat_assess_confidence=-1,
                            threat_assess_rating=-1):
        tc = get_client()
        indicators = tc.indicators()
        filter1 = indicators.add_filter()
        filter1.add_indicator(indicator)

        raw_indicators = []
        for ind in indicators.retrieve():
            if rating is not None:
                ind.set_rating(rating)
            if confidence is not None:
                ind.set_confidence(int(confidence))
            if false_positive:
                ind.add_false_positive()
            if observations != 0:
                ind.add_observation(observations)
            if security_label is not None:
                ind.add_security_label(security_label)
            if threat_assess_confidence != -1:
                ind.set_threat_assess_confidence(threat_assess_confidence)
            if threat_assess_rating != -1:
                ind.set_threat_assess_rating(threat_assess_rating)

            if ind.type == 'File' and size is not None:
                ind.add_size(size)
            if ind.type == 'Host' and dns_active is not None:
                ind.set_dns_active(dns_active)
            if ind.type == 'Host' and whois_active is not None:
                ind.set_whois_active(whois_active)

            raw_indicators.append(json.loads(ind.commit().json))

        return raw_indicators


    def tc_delete_indicator_command():
        args = demisto.args()
        indicator = args['indicator']

        tc_delete_indicator(indicator)

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['text'],
            'Contents': 'Indicator {} removed Successfully'.format(indicator)
        })


    @logger
    def tc_delete_indicator(indicator):
        tc = get_client()
        indicators = tc.indicators()
        filter1 = indicators.add_filter()
        filter1.add_indicator(indicator)
        indicators = indicators.retrieve()
        for ind in indicators:
            ind.delete()


    def tc_delete_indicator_tag_command():
        args = demisto.args()
        indicator = args['indicator']
        tag = args['tag']

        indicators = tc_delete_indicator_tag(indicator, tag)
        raw_indicators = [json.loads(ind.json) for ind in indicators]
        ec, _ = create_context(raw_indicators)

        md = []
        for ind in indicators:
            md.append('Removed tag {} from indicator {}.'.format(tag, ind.indicator))
        if len(md) == 0:
            md.append('No indicators found')

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['text'],
            'Contents': raw_indicators,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join(md),
            'EntryContext': ec
        })


    @logger
    def tc_delete_indicator_tag(indicator, tag, owners=None):
        tc = get_client()
        indicators = tc.indicators()
        filter1 = indicators.add_filter()
        filter1.add_indicator(indicator)

        if owners is not None:
            owners = owners.split(",")
            filter1.add_owner(owners)

        indicators = indicators.retrieve()
        for indicator in indicators:
            indicator.delete_tag(tag)
            indicator.commit()

        return indicators


    def tc_create_campaign_command():
        args = demisto.args()
        name = args['name']
        owner = args.get('owner', demisto.params()['defaultOrg'])
        if owner == '':
            return_error('You must specify an owner in the command, or by using the Organization parameter.')

        first_seen = args.get('firstSeen', datetime.utcnow().isoformat().split('.')[0] + 'Z')
        tag = args.get('tag')
        security_label = args.get('securityLabel')
        description = args.get('description')

        raw_campaign = tc_create_campaign(name, owner, first_seen, tag, security_label, description)
        ec = {
            'ID': raw_campaign['id'],
            'Name': raw_campaign['name'],
            'Owner': raw_campaign['owner']['name'],
            'FirstSeen': raw_campaign['firstSeen'],
            'Tag': tag,
            'SecurityLabel': security_label
        }

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_campaign,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': 'Campaign {} Created Successfully'.format(name),
            'EntryContext': {
                'TC.Campaign(val.ID && val.ID === obj.ID)': createContext([ec], removeNull=True)
            }
        })


    @logger
    def tc_create_campaign(name, owner, first_seen, tag=None, security_label=None, description=None):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('POST')
        ro.set_request_uri('/v2/groups/campaigns')
        body = {
            'name': name,
            'firstSeen': first_seen,
        }
        ro.set_body(json.dumps(body))
        response = tc.api_request(ro).json()

        if response.get('status') == 'Success':
            output = response.get('data', {}).get('campaign', {})
            event_id = output['id']
            if description is not None:
                # Associate Attribute description
                ro = RequestObject()
                ro.set_http_method('POST')
                ro.set_request_uri('/v2/groups/events/{}/attributes'.format(event_id))
                body = {
                    'type': 'Description',
                    'value': description,
                    'displayed': 'true'
                }
                ro.set_body(json.dumps(body))
                tc.api_request(ro).json()

            return output
        else:
            return_error('Failed to create event')


    def tc_create_event_command():
        args = demisto.args()
        name = args['name']
        event_date = args.get('EventDate', datetime.utcnow().isoformat().split('.')[0] + 'Z')
        status = args.get('status')
        owner = args.get('owner', demisto.params()['defaultOrg'])
        if owner == '':
            return_error('You must specify an owner in the command, or by using the Organization parameter.')

        description = args.get('description')
        tag = args.get('tag')

        raw_event = tc_create_event(name, owner, event_date, tag, status, description)
        ec = {
            'ID': raw_event['id'],
            'Name': raw_event['name'],
            'Owner': raw_event['owner']['name'],
            'Date': raw_event['eventDate'],
            'Tag': tag,
            'Status': status
        }

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_event,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': 'Incident {} Created Successfully'.format(name),
            'EntryContext': {
                'TC.Event(val.ID && val.ID === obj.ID)': createContext([ec], removeNull=True)
            }
        })


    def tc_create_event(name, owner, event_date, tag=None, status=None, description=None):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('POST')
        ro.set_request_uri('/v2/groups/events')
        body = {
            'name': name,
            'eventDate': event_date,
            'status': status
        }
        ro.set_body(json.dumps(body))
        response = tc.api_request(ro).json()

        if response.get('status') == 'Success':
            output = response.get('data', {}).get('event', {})
            event_id = output['id']
            if description is not None:
                # Associate Attribute description
                ro = RequestObject()
                ro.set_http_method('POST')
                ro.set_request_uri('/v2/groups/events/{}/attributes'.format(event_id))
                body = {
                    'type': 'Description',
                    'value': description,
                    'displayed': 'true'
                }
                ro.set_body(json.dumps(body))
                tc.api_request(ro).json()

            return output
        else:
            return_error('Failed to create event')


    def tc_create_threat_command():
        args = demisto.args()
        name = args['name']
        date = args.get('dateAdded', datetime.utcnow().isoformat().split('.')[0] + 'Z')
        owner = args.get('owner', demisto.params()['defaultOrg'])
        if owner == '':
            return_error('You must specify an owner in the command, or by using the Organization parameter.')

        raw_threat = tc_create_threat(name, owner, date)
        ec = {
            'ID': raw_threat['id'],
            'Name': raw_threat['name']
        }

        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': raw_threat,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': 'Threat {} Created Successfully'.format(name),
            'EntryContext': {
                'TC.Threat(val.ID && val.ID === obj.ID)': createContext([ec], removeNull=True)
            }
        })


    def tc_create_threat(name, owner, date):
        tc = get_client()
        threats = tc.threats()
        threat = threats.add(name, owner)
        threat.set_date_added(date)

        return json.loads(threat.commit().json)


    def tc_delete_group_command():
        args = demisto.args()
        group_id = int(args['groupID'])
        group_type = args['type']

        success = tc_delete_group(group_id, group_type.lower())
        if success:
            demisto.results({
                'Type': entryTypes['note'],
                'ContentsFormat': formats['text'],
                'Contents': '{} {} deleted Successfully'.format(group_type.lower(), group_id)
            })
        else:
            return_error('Failed to delete {} {}'.format(group_type, group_id))


    def tc_delete_group(group_id, group_type):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('DELETE')
        ro.set_request_uri('/v2/groups/{}/{}'.format(group_type, group_id))
        response = tc.api_request(ro).json()

        return response['status'] == 'Success'


    def tc_add_group_attribute_request(group_type, group_id, attribute_type, attribute_value):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('POST')
        ro.set_request_uri('/v2/groups/{}/{}/attributes'.format(group_type, group_id))
        body = {
            'type': attribute_type,
            'value': attribute_value,
            'displayed': 'true'
        }
        ro.set_body(json.dumps(body))
        response = tc.api_request(ro).json()

        return response


    def tc_add_group_attribute():
        group_id = int(demisto.args().get('group_id'))
        group_type = demisto.args().get('group_type')
        attribute_type = demisto.args().get('attribute_type')
        attribute_value = demisto.args().get('attribute_value')
        headers = ['Type', 'Value', 'ID', 'DateAdded', 'LastModified']
        attribute = tc_add_group_attribute_request(group_type, group_id, attribute_type, attribute_value)
        data = attribute.get('data').get('attribute')
        contents = {
            'Type': data.get('type'),
            'Value': data.get('value'),
            'ID': data.get('id'),
            'DateAdded': data.get('dateAdded'),
            'LastModified': data.get('lastModified')
        }
        context = {
            'TC.Group(val.ID && val.ID === obj.ID)': contents
        }

        return_outputs(
            tableToMarkdown('The attribute was added successfully to group {}'.format(group_id), contents, headers,
                            removeNull=True),
            context,
            attribute
        )


    def add_group_security_label_request(group_type, group_id, security_label):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('POST')
        ro.set_request_uri('/v2/groups/{}/{}/securityLabels/{}'.format(group_type, group_id, security_label))

        response = tc.api_request(ro).json()

        return response.get('status') == 'Success'


    def add_group_security_label():
        group_id = int(demisto.args().get('group_id'))
        group_type = demisto.args().get('group_type')
        security_label = demisto.args().get('security_label_name')

        add_group_security_label_request(group_type, group_id, security_label)

        demisto.results('The security label {} was added successfully to {} {}'.format(security_label, group_type,
                                                                                       group_id))


    def add_group_tags_request(group_type, group_id, tag_name):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('POST')
        ro.set_request_uri('/v2/groups/{}/{}/tags/{}'.format(group_type, group_id, tag_name))

        response = tc.api_request(ro).json()

        return response.get('status') == 'Success'


    def add_group_tag():
        group_id = int(demisto.args().get('group_id'))
        group_type = demisto.args().get('group_type')
        tag_name = demisto.args().get('tag_name')

        add_group_tags_request(group_type, group_id, tag_name)

        demisto.results('The tag {} was added successfully to group {} {}'.format(tag_name, group_type, group_id))


    def get_events_request():
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('GET')
        ro.set_request_uri('/v2/groups/events')

        return tc.api_request(ro).json()


    def tc_get_events():
        raw_response = get_events_request()
        data = raw_response.get('data', {}).get('event', [])
        content = []
        headers = ['ID', 'Name', 'OwnerName', 'EventDate', 'DateAdded', 'Status']

        for event in data:
            content.append({
                'ID': event.get('id'),
                'Name': event.get('name'),
                'OwnerName': event.get('ownerName'),
                'DateAdded': event.get('dateAdded'),
                'EventDate': event.get('eventDate'),
                'Status': event.get('status')
            })
        context = {
            'TC.Event(val.ID && val.ID === obj.ID)': content
        }

        return_outputs(
            tableToMarkdown('ThreatConnect Events', content, headers, removeNull=True),
            context,
            raw_response
        )


    def tc_get_indicator_types_request():
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('GET')
        ro.set_request_uri('/v2/types/indicatorTypes')

        return tc.api_request(ro).json()


    def tc_get_indicator_types():
        raw_response = tc_get_indicator_types_request()
        data = raw_response.get('data', {}).get('indicatorType', [])
        content = []
        headers = ['Name', 'Custom', 'Parsable', 'ApiBranch', 'CasePreference', 'value1Label', 'Value1Type']

        for type_ in data:
            content.append({
                'Custom': type_.get('custom'),
                'Name': type_.get('name'),
                'Parsable': type_.get('parsable'),
                'ApiBranch': type_.get('apiBranch'),
                'ApiEntity': type_.get('apiEntity'),
                'CasePreference': type_.get('casePreference'),
                'Value1Label': type_.get('value1Label'),
                'Value1Type': type_.get('value1Type')
            })
        context = {
            'TC.IndicatorType(val.Name && val.Name === obj.Name)': content
        }

        return_outputs(
            tableToMarkdown('ThreatConnect indicator types', content, headers, removeNull=True),
            context,
            raw_response
        )


    def associate_indicator_request(indicator_type, indicator, group_type, group_id):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('POST')
        ro.set_request_uri('/v2/indicators/{}/{}/groups/{}/{}'.format(indicator_type, indicator, group_type, group_id))
        response = tc.api_request(ro).json()

        return response


    def associate_indicator():
        group_id = int(demisto.args().get('group_id'))
        group_type = demisto.args().get('group_type')
        indicator_type = demisto.args().get('indicator_type')
        indicator = demisto.args().get('indicator')

        response = associate_indicator_request(indicator_type, indicator, group_type, group_id)

        if response.get('status') == 'Success':
            contents = {
                'IndicatorType': indicator_type,
                'Indicator': indicator,
                'GroupType': group_type,
                'GroupID': group_id
            }
        else:
            return_error(response.get('message'))

        context = {
            'TC.Group(val.Indicator && val.Indicator === obj.Indicator)': contents
        }

        return_outputs(
            tableToMarkdown('The indicator was associated successfully', contents, removeNull=True),
            context
        )


    def get_groups_request(group_type):
        tc = get_client()
        ro = RequestObject()
        ro.set_http_method('GET')
        ro.set_request_uri('/v2/groups/{}'.format(group_type))

        return tc.api_request(ro).json()


    def tc_get_groups():
        group_type = demisto.args().get('group_type')
        raw_response = get_groups_request(group_type)
        headers = ['ID', 'Name', 'OwnerName', 'EventDate', 'DateAdded', 'Status']
        if group_type == 'adversaries':
            data = raw_response.get('data', {}).get('adversarie', {})
        if group_type == 'campaigns':
            data = raw_response.get('data', {}).get('campaign', {})
        if group_type == 'documents':
            data = raw_response.get('data', {}).get('document', {})
        if group_type == 'emails':
            data = raw_response.get('data', {}).get('email', {})
        if group_type == 'events':
            data = raw_response.get('data', {}).get('event', {})
        if group_type == 'incidents':
            data = raw_response.get('data', {}).get('incident', {})
        if group_type == 'intrusionSets':
            data = raw_response.get('data', {}).get('intrusionSet', {})
        if group_type == 'reports':
            data = raw_response.get('data', {}).get('report', {})
        if group_type == 'signatures':
            data = raw_response.get('data', {}).get('signature', {})
        if group_type == 'threats':
            data = raw_response.get('data', {}).get('threat', {})

        content = []

        for group in data:
            content.append({
                'ID': group.get('id'),
                'Name': group.get('name'),
                'OwnerName': group.get('ownerName'),
                'DateAdded': group.get('dateAdded'),
                'EventDate': group.get('eventDate'),
                'Status': group.get('status')
            })
        context = {
            'TC.Group(val.ID && val.ID === obj.ID)': content
        }

        return_outputs(
            tableToMarkdown('ThreatConnect {}'.format(group_type), content, headers, removeNull=True),
            context,
            raw_response
        )


    def create_document_group_request(contents, file_name, name, owner, res, malware, password, security_label,
                                      description):
        tc = get_client()
        documents = tc.documents()

        document = documents.add(name, owner)
        document.set_file_name(file_name)

        # upload the contents of the file into the Document
        document.upload(contents)
        if malware:
            document.set_malware(True)
            document.set_password(password)
        if security_label:
            document.set_security_label(security_label)
        if description:
            document.add_attribute('Description', description)

        return json.loads(document.commit().json)


    def create_document_group():
        file_name = demisto.args().get('file_name')
        name = demisto.args().get('name')
        malware = bool(strtobool(demisto.args().get('malware', False)))
        password = demisto.args().get('password')
        res = demisto.getFilePath(demisto.args()['entry_id'])
        owner = demisto.args().get('owner', demisto.params().get('defaultOrg'))
        if not owner:
            return_error('You must specify an owner in the command, or by using the Organization parameter.')

        security_label = demisto.args().get('securityLabel')
        description = demisto.args().get('description')

        # open a file handle for a local file and read the contents thereof
        f = open(res['path'], 'rb')
        contents = f.read()

        raw_document = create_document_group_request(contents, file_name, name, owner, res, malware, password,
                                                     security_label, description)
        content = {
            'ID': raw_document.get('id'),
            'Name': raw_document.get('name'),
            'Owner': raw_document.get('ownerName'),
            'EventDate': raw_document.get('eventDate'),
            'Description': description,
            'SecurityLabel': security_label
        }
        context = {
            'TC.Group(val.ID && val.ID === obj.ID)': content
        }
        return_outputs(tableToMarkdown('ThreatConnect document group was created successfully', content, removeNull=True),
                       context,
                       raw_document)


    def test_integration():
        tc = get_client()
        owners = tc.owners()
        owners.retrieve()
        demisto.results('ok')


    ''' EXECUTION CODE '''
    COMMANDS = {
        'test-module': test_integration,
        'ip': ip_command,
        'url': url_command,
        'file': file_command,
        'domain': domain_command,

        'tc-owners': tc_owners_command,
        'tc-indicators': tc_indicators_command,
        'tc-get-tags': tc_get_tags_command,
        'tc-tag-indicator': tc_tag_indicator_command,
        'tc-get-indicator': tc_get_indicator_command,
        'tc-get-indicators-by-tag': tc_get_indicators_by_tag_command,
        'tc-add-indicator': tc_add_indicator_command,

        'tc-create-incident': tc_create_incident_command,
        'tc-fetch-incidents': tc_fetch_incidents_command,
        'tc-get-incident-associate-indicators': tc_get_incident_associate_indicators_command,
        'tc-incident-associate-indicator': tc_incident_associate_indicator_command,
        'tc-update-indicator': tc_update_indicator_command,
        'tc-delete-indicator': tc_delete_indicator_command,
        'tc-delete-indicator-tag': tc_delete_indicator_tag_command,
        'tc-create-campaign': tc_create_campaign_command,
        'tc-create-event': tc_create_event_command,
        'tc-get-events': tc_get_events,
        'tc-add-group-attribute': tc_add_group_attribute,
        'tc-create-threat': tc_create_threat_command,
        'tc-delete-group': tc_delete_group_command,
        'tc-get-groups': tc_get_groups,
        'tc-add-group-security-label': add_group_security_label,
        'tc-add-group-tag': add_group_tag,
        'tc-get-indicator-types': tc_get_indicator_types,
        'tc-group-associate-indicator': associate_indicator,
        'tc-create-document-group': create_document_group
    }

    try:
        command_func = demisto.command()
        LOG('command is %s' % (demisto.command(),))
        if command_func in COMMANDS.keys():
            COMMANDS[command_func]()

    except Exception as e:
        LOG(e.message)
        LOG.print_log()
        return_error('error has occurred: {}'.format(e.message, ))
  type: python
system: true
